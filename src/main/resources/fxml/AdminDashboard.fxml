<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>

<BorderPane fx:id="rootPane" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="tn.esprit.farmvision.gestionuser.controller.AdminDashboardController"
            stylesheets="@../css/dashboard-ai.css">

    <!-- HEADER -->
    <top>
        <VBox styleClass="header-container">
            <padding><Insets top="20" right="30" bottom="20" left="30"/></padding>

            <HBox alignment="CENTER_LEFT" spacing="20">
                <VBox HBox.hgrow="ALWAYS">
                    <Label fx:id="lblWelcome" text="ðŸ‘‹ Bienvenue Administrateur" styleClass="header-title"/>
                    <Label text="Dashboard Statistique " styleClass="header-subtitle"/>
                </VBox>

                <Button text="ðŸ¤– AI" styleClass="btn-ai"/>
                <Button text="ðŸ‘¤ Profil" onAction="#ouvrirProfil" styleClass="btn-profile"/>
                <Button text="ðŸ”“ DÃ©connexion" onAction="#logout" styleClass="btn-logout"/>
            </HBox>
        </VBox>
    </top>

    <!-- CONTENU PRINCIPAL -->
    <center>
        <ScrollPane fitToWidth="true">
            <VBox spacing="25">
                <padding><Insets top="30" right="30" bottom="30" left="30"/></padding>

                <!-- CARTES STATISTIQUES KPI -->
                <GridPane hgap="20" vgap="20">
                    <VBox GridPane.columnIndex="0" spacing="10" alignment="CENTER" styleClass="kpi-card-purple">
                        <Label text="ðŸ‘¥" styleClass="kpi-icon"/>
                        <Label fx:id="lblTotalUsers" text="0" styleClass="kpi-value"/>
                        <Label text="Total Utilisateurs" styleClass="kpi-label"/>
                    </VBox>

                    <VBox GridPane.columnIndex="1" spacing="10" alignment="CENTER" styleClass="kpi-card-green">
                        <Label text="âœ…" styleClass="kpi-icon"/>
                        <Label fx:id="lblActiveUsers" text="0" styleClass="kpi-value"/>
                        <Label text="Utilisateurs Actifs" styleClass="kpi-label"/>
                    </VBox>

                    <VBox GridPane.columnIndex="2" spacing="10" alignment="CENTER" styleClass="kpi-card-pink">
                        <Label text="â³" styleClass="kpi-icon"/>
                        <Label fx:id="lblPendingUsers" text="0" styleClass="kpi-value"/>
                        <Label text="En Attente" styleClass="kpi-label"/>
                    </VBox>

                    <VBox GridPane.columnIndex="3" spacing="10" alignment="CENTER" styleClass="kpi-card-blue">
                        <Label text="ðŸ†•" styleClass="kpi-icon"/>
                        <Label fx:id="lblNewUsers" text="0" styleClass="kpi-value"/>
                        <Label text="Nouveaux (7j)" styleClass="kpi-label"/>
                    </VBox>
                </GridPane>

                <!-- SECTION IA - PRÃ‰DICTIONS -->
                <VBox spacing="15" styleClass="ai-section">
                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <Label text="ðŸ¤–" style="-fx-font-size: 32px;"/>
                        <Label text="Intelligence Artificielle - PrÃ©dictions" styleClass="ai-title"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Label text="POWERED BY AI" styleClass="ai-badge"/>
                    </HBox>

                    <GridPane hgap="20" vgap="15">
                        <VBox GridPane.columnIndex="0" spacing="8" styleClass="ai-prediction-box">
                            <Label text="ðŸ“… Dans 7 jours" styleClass="ai-prediction-label"/>
                            <Label fx:id="lblPredict7Days" text="+0" styleClass="ai-prediction-value"/>
                            <Label text="nouveaux utilisateurs" styleClass="ai-prediction-desc"/>
                        </VBox>

                        <VBox GridPane.columnIndex="1" spacing="8" styleClass="ai-prediction-box">
                            <Label text="ðŸ“ˆ Dans 30 jours" styleClass="ai-prediction-label"/>
                            <Label fx:id="lblPredict30Days" text="+0" styleClass="ai-prediction-value"/>
                            <Label text="nouveaux utilisateurs" styleClass="ai-prediction-desc"/>
                        </VBox>

                        <VBox GridPane.columnIndex="2" spacing="8" alignment="CENTER" styleClass="ai-prediction-box">
                            <Label text="ðŸŽ¯ Confiance" styleClass="ai-prediction-label"/>
                            <Label fx:id="lblAIConfidence" text="0%" styleClass="ai-prediction-value"/>
                            <Label text="niveau de prÃ©cision" styleClass="ai-prediction-desc"/>
                        </VBox>
                    </GridPane>

                    <HBox alignment="CENTER_LEFT" spacing="10" styleClass="ai-trend">
                        <Label text="ðŸ“‰" style="-fx-font-size: 18px;"/>
                        <Label fx:id="lblGrowthTrend" text="Tendance: Croissance stable" styleClass="ai-trend-text"/>
                    </HBox>
                </VBox>

                <!-- ANOMALIES & RECOMMANDATIONS -->
                <GridPane hgap="20">
                    <VBox GridPane.columnIndex="0" spacing="15" styleClass="white-card">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="ðŸ”" styleClass="card-icon"/>
                            <Label text="Anomalies DÃ©tectÃ©es" styleClass="card-title"/>
                        </HBox>
                        <Separator/>
                        <ListView fx:id="listAnomalies" prefHeight="200"/>
                    </VBox>

                    <VBox GridPane.columnIndex="1" spacing="15" styleClass="white-card">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="ðŸ’¡" styleClass="card-icon"/>
                            <Label text="Recommandations IA" styleClass="card-title"/>
                        </HBox>
                        <Separator/>
                        <ListView fx:id="listRecommendations" prefHeight="200"/>
                    </VBox>
                </GridPane>

                <!-- INSIGHTS INTELLIGENTS -->
                <VBox spacing="15" styleClass="white-card">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label text="âœ¨" styleClass="card-icon"/>
                        <Label text="Insights Intelligents" styleClass="card-title"/>
                    </HBox>
                    <Separator/>
                    <HBox fx:id="boxInsights" spacing="20"/>
                </VBox>

                <!-- GRAPHIQUES -->
                <GridPane hgap="20" vgap="20">
                    <VBox GridPane.columnIndex="0" spacing="15" styleClass="white-card">
                        <Label text="ðŸ“Š Distribution des Utilisateurs" styleClass="card-title"/>
                        <PieChart fx:id="pieChartDistribution" legendVisible="true" prefHeight="300"/>
                        <VBox spacing="8">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="ðŸŒ¾" style="-fx-font-size: 18px;"/>
                                <Label text="Agriculteurs:" style="-fx-font-size: 13px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblAgriculteurs" text="0" style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                            </HBox>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="ðŸ‘”" style="-fx-font-size: 18px;"/>
                                <Label text="Responsables:" style="-fx-font-size: 13px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblResponsables" text="0" style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: #3498db;"/>
                            </HBox>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="âš™ï¸" style="-fx-font-size: 18px;"/>
                                <Label text="Administrateurs:" style="-fx-font-size: 13px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblAdmins" text="0" style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: #e74c3c;"/>
                            </HBox>
                        </VBox>
                    </VBox>

                    <VBox GridPane.columnIndex="1" spacing="15" styleClass="white-card">
                        <Label text="ðŸ“ˆ Ã‰volution des Inscriptions (30j)" styleClass="card-title"/>
                        <LineChart fx:id="lineChartTrend" prefHeight="300" legendVisible="false">
                            <xAxis><CategoryAxis side="BOTTOM" label="Date"/></xAxis>
                            <yAxis><NumberAxis side="LEFT" label="Inscriptions"/></yAxis>
                        </LineChart>
                        <HBox spacing="10" alignment="CENTER" styleClass="activation-box">
                            <Label text="ðŸ“Š Taux d'activation:" style="-fx-font-size: 13px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <Label fx:id="lblActivationRate" text="0%" styleClass="activation-rate-high"/>
                        </HBox>
                    </VBox>
                </GridPane>

                <!-- ACTIONS RAPIDES -->
                <VBox spacing="15" styleClass="white-card">
                    <Label text="âš¡ Actions Rapides" styleClass="card-title"/>
                    <Separator/>
                    <HBox spacing="15">
                        <Button text="ðŸ‘¥ GÃ©rer les Utilisateurs" onAction="#ouvrirGestionUsers"
                                prefWidth="230" styleClass="btn-action-primary"/>
                        <Button text="âœ… Valider les Comptes" onAction="#validerComptes"
                                prefWidth="230" styleClass="btn-action-success"/>
                        <Button text="ðŸ”„ Actualiser" onAction="#refreshStats"
                                prefWidth="180" styleClass="btn-action-secondary"/>
                    </HBox>
                </VBox>

                <!-- LISTES (RÃ©cents + En attente) -->
                <GridPane hgap="20">
                    <VBox GridPane.columnIndex="0" spacing="15" styleClass="white-card">
                        <Label text="ðŸ†• DerniÃ¨res Inscriptions" styleClass="card-title"/>
                        <Separator/>
                        <ListView fx:id="listRecentUsers" prefHeight="200"/>
                    </VBox>

                    <VBox GridPane.columnIndex="1" spacing="15" styleClass="white-card">
                        <Label text="â³ Comptes en Attente de Validation" styleClass="card-title"/>
                        <Separator/>
                        <ListView fx:id="listPendingUsers" prefHeight="200"/>
                    </VBox>
                </GridPane>

            </VBox>
        </ScrollPane>
    </center>

</BorderPane>
