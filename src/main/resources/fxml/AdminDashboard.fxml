<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.chart.*?>

<BorderPane fx:id="rootPane" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javxml.com/fxml/1"
            fx:controller="tn.esprit.farmvision.gestionuser.controller.AdminDashboardController"
            style="-fx-background-color: linear-gradient(to bottom, #f8f9fa, #e9ecef);">

    <!-- HEADER -->
    <top>
        <VBox style="-fx-background-color: white; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 10, 0, 0, 2);">
            <padding>
                <Insets top="20" right="30" bottom="20" left="30"/>
            </padding>

            <HBox alignment="CENTER_LEFT" spacing="20">
                <VBox HBox.hgrow="ALWAYS">
                    <Label fx:id="lblWelcome" text="ðŸ‘‹ Bienvenue Administrateur"
                           style="-fx-font-size: 26px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                    <Label text="Dashboard Statistique avec Intelligence Artificielle"
                           style="-fx-font-size: 14px; -fx-text-fill: #7f8c8d;"/>
                </VBox>

                <Button text="ðŸ¤– AI"
                        style="-fx-background-color: #9b59b6; -fx-text-fill: white; -fx-font-size: 13px;
                               -fx-padding: 10 20; -fx-background-radius: 8; -fx-cursor: hand; -fx-font-weight: bold;"/>

                <Button text="ðŸ‘¤ Profil" onAction="#ouvrirProfil"
                        style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-size: 13px;
                               -fx-padding: 10 20; -fx-background-radius: 8; -fx-cursor: hand;"/>

                <Button text="ðŸ”“ DÃ©connexion" onAction="#logout"
                        style="-fx-background-color: #e74c3c; -fx-text-fill: white; -fx-font-size: 13px;
                               -fx-padding: 10 20; -fx-background-radius: 8; -fx-cursor: hand;"/>
            </HBox>
        </VBox>
    </top>

    <!-- CONTENU PRINCIPAL -->
    <center>
        <ScrollPane fitToWidth="true" style="-fx-background-color: transparent; -fx-background: transparent;">
            <VBox spacing="25">
                <padding>
                    <Insets top="30" right="30" bottom="30" left="30"/>
                </padding>

                <!-- CARTES STATISTIQUES -->
                <GridPane hgap="20" vgap="20">
                    <VBox GridPane.columnIndex="0" GridPane.rowIndex="0" spacing="10" alignment="CENTER"
                          style="-fx-background-color: linear-gradient(to bottom right, #667eea, #764ba2);
                                 -fx-background-radius: 15; -fx-padding: 25;
                                 -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.2), 15, 0, 0, 5);">
                        <Label text="ðŸ‘¥" style="-fx-font-size: 40px;"/>
                        <Label fx:id="lblTotalUsers" text="0"
                               style="-fx-font-size: 36px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                        <Label text="Total Utilisateurs"
                               style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.9;"/>
                    </VBox>

                    <VBox GridPane.columnIndex="1" GridPane.rowIndex="0" spacing="10" alignment="CENTER"
                          style="-fx-background-color: linear-gradient(to bottom right, #56ab2f, #a8e063);
                                 -fx-background-radius: 15; -fx-padding: 25;
                                 -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.2), 15, 0, 0, 5);">
                        <Label text="âœ…" style="-fx-font-size: 40px;"/>
                        <Label fx:id="lblActiveUsers" text="0"
                               style="-fx-font-size: 36px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                        <Label text="Utilisateurs Actifs"
                               style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.9;"/>
                    </VBox>

                    <VBox GridPane.columnIndex="2" GridPane.rowIndex="0" spacing="10" alignment="CENTER"
                          style="-fx-background-color: linear-gradient(to bottom right, #f093fb, #f5576c);
                                 -fx-background-radius: 15; -fx-padding: 25;
                                 -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.2), 15, 0, 0, 5);">
                        <Label text="â³" style="-fx-font-size: 40px;"/>
                        <Label fx:id="lblPendingUsers" text="0"
                               style="-fx-font-size: 36px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                        <Label text="En Attente"
                               style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.9;"/>
                    </VBox>

                    <VBox GridPane.columnIndex="3" GridPane.rowIndex="0" spacing="10" alignment="CENTER"
                          style="-fx-background-color: linear-gradient(to bottom right, #4facfe, #00f2fe);
                                 -fx-background-radius: 15; -fx-padding: 25;
                                 -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.2), 15, 0, 0, 5);">
                        <Label text="ðŸ†•" style="-fx-font-size: 40px;"/>
                        <Label fx:id="lblNewUsers" text="0"
                               style="-fx-font-size: 36px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                        <Label text="Nouveaux (7j)"
                               style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.9;"/>
                    </VBox>
                </GridPane>

                <!-- ========== SECTION AI - PRÃ‰DICTIONS ========== -->
                <VBox spacing="15"
                      style="-fx-background-color: linear-gradient(to bottom right, #8E2DE2, #4A00E0);
                             -fx-background-radius: 15; -fx-padding: 25;
                             -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.3), 20, 0, 0, 8);">

                    <HBox alignment="CENTER_LEFT" spacing="15">
                        <Label text="ðŸ¤–" style="-fx-font-size: 32px;"/>
                        <Label text="Intelligence Artificielle - PrÃ©dictions"
                               style="-fx-font-size: 20px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                    </HBox>

                    <GridPane hgap="20" vgap="15">
                        <!-- PrÃ©diction 7 jours -->
                        <VBox GridPane.columnIndex="0" spacing="8"
                              style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12;
                                     -fx-padding: 20;">
                            <Label text="ðŸ“… Dans 7 jours"
                                   style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.8;"/>
                            <Label fx:id="lblPredict7Days" text="+0"
                                   style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                            <Label text="nouveaux utilisateurs"
                                   style="-fx-font-size: 12px; -fx-text-fill: white; -fx-opacity: 0.7;"/>
                        </VBox>

                        <!-- PrÃ©diction 30 jours -->
                        <VBox GridPane.columnIndex="1" spacing="8"
                              style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12;
                                     -fx-padding: 20;">
                            <Label text="ðŸ“ˆ Dans 30 jours"
                                   style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.8;"/>
                            <Label fx:id="lblPredict30Days" text="+0"
                                   style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                            <Label text="nouveaux utilisateurs"
                                   style="-fx-font-size: 12px; -fx-text-fill: white; -fx-opacity: 0.7;"/>
                        </VBox>

                        <!-- Confiance AI -->
                        <VBox GridPane.columnIndex="2" spacing="8" alignment="CENTER"
                              style="-fx-background-color: rgba(255,255,255,0.15); -fx-background-radius: 12;
                                     -fx-padding: 20;">
                            <Label text="ðŸŽ¯ Confiance"
                                   style="-fx-font-size: 14px; -fx-text-fill: white; -fx-opacity: 0.8;"/>
                            <Label fx:id="lblAIConfidence" text="0%"
                                   style="-fx-font-size: 28px; -fx-font-weight: bold; -fx-text-fill: white;"/>
                            <Label text="niveau de prÃ©cision"
                                   style="-fx-font-size: 12px; -fx-text-fill: white; -fx-opacity: 0.7;"/>
                        </VBox>
                    </GridPane>

                    <Label fx:id="lblGrowthTrend" text="ðŸ“Š Tendance: Croissance stable"
                           style="-fx-font-size: 13px; -fx-text-fill: white; -fx-opacity: 0.9;"/>
                </VBox>

                <!-- ========== SECTION AI - ANOMALIES & RECOMMANDATIONS ========== -->
                <GridPane hgap="20">
                    <!-- Anomalies DÃ©tectÃ©es -->
                    <VBox GridPane.columnIndex="0" spacing="15"
                          style="-fx-background-color: white; -fx-background-radius: 15;
                                 -fx-padding: 25; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 15, 0, 0, 5);">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="ðŸ”" style="-fx-font-size: 24px;"/>
                            <Label text="Anomalies DÃ©tectÃ©es"
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                        </HBox>

                        <ListView fx:id="listAnomalies"
                                  prefHeight="200"
                                  style="-fx-background-color: transparent;"/>
                    </VBox>

                    <!-- Recommandations AI -->
                    <VBox GridPane.columnIndex="1" spacing="15"
                          style="-fx-background-color: white; -fx-background-radius: 15;
                                 -fx-padding: 25; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 15, 0, 0, 5);">
                        <HBox alignment="CENTER_LEFT" spacing="10">
                            <Label text="ðŸ’¡" style="-fx-font-size: 24px;"/>
                            <Label text="Recommandations IA"
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                        </HBox>

                        <ListView fx:id="listRecommendations"
                                  prefHeight="200"
                                  style="-fx-background-color: transparent;"/>
                    </VBox>
                </GridPane>

                <!-- ========== INSIGHTS INTELLIGENTS ========== -->
                <VBox spacing="15"
                      style="-fx-background-color: white; -fx-background-radius: 15;
                             -fx-padding: 25; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 15, 0, 0, 5);">
                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <Label text="âœ¨" style="-fx-font-size: 24px;"/>
                        <Label text="Insights Intelligents"
                               style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                    </HBox>

                    <HBox fx:id="boxInsights" spacing="20"/>
                </VBox>

                <!-- GRAPHIQUES -->
                <GridPane hgap="20" vgap="20">
                    <VBox GridPane.columnIndex="0" GridPane.rowIndex="0" spacing="15"
                          style="-fx-background-color: white; -fx-background-radius: 15;
                                 -fx-padding: 25; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 15, 0, 0, 5);">
                        <Label text="ðŸ“Š Distribution des Utilisateurs"
                               style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

                        <PieChart fx:id="pieChartDistribution"
                                  legendVisible="true"
                                  prefHeight="300"
                                  style="-fx-background-color: transparent;"/>

                        <VBox spacing="8">
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="ðŸŒ¾" style="-fx-font-size: 18px;"/>
                                <Label text="Agriculteurs:" style="-fx-font-size: 13px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblAgriculteurs" text="0"
                                       style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                            </HBox>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="ðŸ‘”" style="-fx-font-size: 18px;"/>
                                <Label text="Responsables:" style="-fx-font-size: 13px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblResponsables" text="0"
                                       style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: #3498db;"/>
                            </HBox>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <Label text="âš™ï¸" style="-fx-font-size: 18px;"/>
                                <Label text="Administrateurs:" style="-fx-font-size: 13px; -fx-text-fill: #7f8c8d;"/>
                                <Label fx:id="lblAdmins" text="0"
                                       style="-fx-font-size: 15px; -fx-font-weight: bold; -fx-text-fill: #e74c3c;"/>
                            </HBox>
                        </VBox>
                    </VBox>

                    <VBox GridPane.columnIndex="1" GridPane.rowIndex="0" spacing="15"
                          style="-fx-background-color: white; -fx-background-radius: 15;
                                 -fx-padding: 25; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 15, 0, 0, 5);">
                        <Label text="ðŸ“ˆ Ã‰volution des Inscriptions (30j)"
                               style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

                        <LineChart fx:id="lineChartTrend"
                                   prefHeight="300"
                                   legendVisible="false"
                                   style="-fx-background-color: transparent;">
                            <xAxis>
                                <CategoryAxis side="BOTTOM" label="Date"/>
                            </xAxis>
                            <yAxis>
                                <NumberAxis side="LEFT" label="Inscriptions"/>
                            </yAxis>
                        </LineChart>

                        <HBox spacing="10" alignment="CENTER"
                              style="-fx-background-color: #ecf0f1; -fx-padding: 15; -fx-background-radius: 10;">
                            <Label text="ðŸ“Š Taux d'activation:"
                                   style="-fx-font-size: 13px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>
                            <Label fx:id="lblActivationRate" text="0%"
                                   style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #27ae60;"/>
                        </HBox>
                    </VBox>
                </GridPane>

                <!-- ACTIONS RAPIDES -->
                <VBox spacing="15"
                      style="-fx-background-color: white; -fx-background-radius: 15;
                             -fx-padding: 25; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 15, 0, 0, 5);">
                    <Label text="âš¡ Actions Rapides"
                           style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

                    <HBox spacing="15">
                        <Button text="ðŸ‘¥ GÃ©rer les Utilisateurs" onAction="#ouvrirGestionUsers"
                                prefWidth="230"
                                style="-fx-background-color: #3498db; -fx-text-fill: white; -fx-font-size: 14px;
                                       -fx-padding: 15 25; -fx-background-radius: 10; -fx-font-weight: bold; -fx-cursor: hand;"/>

                        <Button text="âœ… Valider les Comptes" onAction="#validerComptes"
                                prefWidth="230"
                                style="-fx-background-color: #27ae60; -fx-text-fill: white; -fx-font-size: 14px;
                                       -fx-padding: 15 25; -fx-background-radius: 10; -fx-font-weight: bold; -fx-cursor: hand;"/>

                        <Button text="ðŸ”„ Actualiser" onAction="#refreshStats"
                                prefWidth="180"
                                style="-fx-background-color: #95a5a6; -fx-text-fill: white; -fx-font-size: 14px;
                                       -fx-padding: 15 25; -fx-background-radius: 10; -fx-font-weight: bold; -fx-cursor: hand;"/>
                    </HBox>
                </VBox>

                <!-- COMPTES RÃ‰CENTS / EN ATTENTE -->
                <GridPane hgap="20">
                    <VBox GridPane.columnIndex="0" spacing="15"
                          style="-fx-background-color: white; -fx-background-radius: 15;
                                 -fx-padding: 25; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 15, 0, 0, 5);">
                        <Label text="ðŸ†• DerniÃ¨res Inscriptions"
                               style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

                        <ListView fx:id="listRecentUsers"
                                  prefHeight="200"
                                  style="-fx-background-color: transparent;"/>
                    </VBox>

                    <VBox GridPane.columnIndex="1" spacing="15"
                          style="-fx-background-color: white; -fx-background-radius: 15;
                                 -fx-padding: 25; -fx-effect: dropshadow(gaussian, rgba(0,0,0,0.1), 15, 0, 0, 5);">
                        <Label text="â³ Comptes en Attente de Validation"
                               style="-fx-font-size: 18px; -fx-font-weight: bold; -fx-text-fill: #2c3e50;"/>

                        <ListView fx:id="listPendingUsers"
                                  prefHeight="200"
                                  style="-fx-background-color: transparent;"/>
                    </VBox>
                </GridPane>

            </VBox>
        </ScrollPane>
    </center>

    <!-- FOOTER -->
    <bottom>
        <HBox alignment="CENTER" style="-fx-background-color: white; -fx-padding: 15;">
            <Label text="Â© 2026 FarmVision - Dashboard Administrateur avec Intelligence Artificielle"
                   style="-fx-text-fill: #95a5a6; -fx-font-size: 12px;"/>
        </HBox>
    </bottom>

</BorderPane>
